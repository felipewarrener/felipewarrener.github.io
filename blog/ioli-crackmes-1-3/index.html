<!DOCTYPE html>
<html lang="en">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

    <meta property="og:image" content="https://felipewarrener.co.uk/img/ioli-level3-test.png"/>
    <meta name="twitter:image:src" content="https://felipewarrener.co.uk/img/ioli-level3-test.png"/>


    
    
    

<title>IOLI CrackMe Challenges Walkthrough • Felipe Warrener-Iglesias</title>


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="IOLI CrackMe Challenges Walkthrough"/>
<meta name="twitter:description" content="A write-up for the IOLI crackme challenges 1-3."/>

<meta property="og:title" content="IOLI CrackMe Challenges Walkthrough" />
<meta property="og:description" content="A write-up for the IOLI crackme challenges 1-3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://felipewarrener.co.uk/blog/ioli-crackmes-1-3/" />
<meta property="article:published_time" content="2020-06-07T23:00:00+00:00" />
<meta property="article:modified_time" content="2020-06-07T23:00:00+00:00" /><meta property="og:site_name" content="Felipe Warrener-Iglesias" />


    








<link rel="stylesheet" href="https://felipewarrener.co.uk/scss/hyde-hyde.7cd2c55f93eb4274e168c39a74729c4043ba8365975c0f0296c7c5a4152fd995.css" integrity="sha256-fNLFX5PrQnThaMOadHKcQEO6g2WXXA8ClsfFpBUv2ZU=" crossorigin="anonymous">


<link rel="stylesheet" href="https://felipewarrener.co.uk/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58&#43;TzH3icCkSHGoJ&#43;ed7w=" crossorigin="anonymous" media="print">



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../../apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="../../favicon.png">
    

</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="https://felipewarrener.co.uk/">Felipe Warrener-Iglesias</a>
      </span>
      
      <p class="site__description">
         A blog about things I&#39;ve encountered on my information security journey. Topics like: CTF challenges, security research and explanations of security concepts. 
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">Felipe Warrener-Iglesias</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="../../blog/">
						<span>Posts</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="../../about/">
						<span>About</span>
					</a>
				</li>
			 
		
		</li>
	</ul>
</div>

        <section class="social">
	
	<a href="https://twitter.com/fwrnr" target="_blank" rel="me"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	
	<a href="https://github.com/felipewarrener" target="_blank" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	<a href="https://linkedin.com/in/felipewarrener-iglesias" rel="me"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="https://stackoverflow.com/users/3527602/felipe-warrener-iglesias" target="_blank" rel="me"><i class="fab fa-stack-overflow fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
</section>

      </div>
    </div>
    <div class="copyright">
  &copy; 2020 Felipe Warrener-Iglesias.
  <br/><a href="https://creativecommons.org/licenses/by-sa/4.0">Some Rights Reserved</a>.
  
</div>

  </div>
</div>

        <div class="content container">
            
    <article>
  <header>
    <h1>IOLI CrackMe Challenges Walkthrough</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> Jun 7, 2020
    
    
    
      
      
          in
          
          
              <a class="badge badge-category" href="../../categories/reverse-engineering">REVERSE-ENGINEERING</a>
              •
          
              <a class="badge badge-category" href="../../categories/write-ups">WRITE-UPS</a>
              
          
      
    
    
    
      
      
          <br/>
           <i class="fas fa-tags"></i>
          
          <a class="badge badge-tag" href="../../tags/crackme">crackme</a>
           
      
          <a class="badge badge-tag" href="../../tags/x86">x86</a>
           
      
          <a class="badge badge-tag" href="../../tags/linux">linux</a>
          
      
    
    
    <br/>
    <i class="fas fa-clock"></i> 7 min read
</div>


  </header>
  
  
  <div class="post">
    

<p>This blog post is a series of write-ups for the IOLI reverse-engineering crackmes. It will end up pretty lengthy as it&rsquo;s intended to be comprehensive. I will be uploading 3 solutions at a time on this blog post. You can skip to any single challenge using the following links:<br />
<a href="#challenge-1">Challenge 1</a><br />
<a href="#challenge-2">Challenge 2</a><br />
<a href="#challenge-3">Challenge 3</a></p>

<h3 id="challenge-1">Challenge 1</h3>

<p><img src="../../img/ioli-level1-main-annotated.png" alt="" /><br />
This challenge consists of a simple comparison inside <strong><code>main()</code></strong> that checks if the user&rsquo;s input (interpreted as a signed-integer) is equal to the value 0x149a and outputs a success message if they are equal (this can be inferred from reading the strings stored in the executable&rsquo;s .rodata section).</p>

<p>I attempted to switch flip the endianness of this value to 0x9a14, convert to decimal (39444) , and then enter this as the password, but the comparison conditional branch jump did not succeed. This should be the correct password in 32-bit context, I am running the challenges compiled for 32-bit on a 64-bit OS, so the values are likely being considered as big-endian. In which case, the correct password is 0x149a converted to decimal, which is 5274.</p>

<h3 id="challenge-2">Challenge 2</h3>

<p><img src="../../img/ioli-level2-main-annotated.png" alt="" /></p>

<p>This program&rsquo;s <strong><code>main()</code></strong> routine contains a call to scanf at <strong><code>0x8048426</code></strong> that stores the output as a signed decimal integer at <strong><code>ebp-0x4</code></strong>.</p>

<p>This program then assigns a local variable on the stack with the value 0x5a (90) and another local variable with the value 0x1ec (492), it then adds these two variables variables resulting in 582 and squares this to make 338724.</p>

<p>The user&rsquo;s input is then interpreted as a signed decimal integer using scanf() and compared to 338724, if the operands in the comparison are equal, the program follows a conditional branch that prints a success message (this was again inferred from referencing the inline string addresses used in the .rodata section).</p>

<h3 id="challenge-3">Challenge 3</h3>

<p>At first glance, challenge 3 does not appear to contain any useful strings. When viewing the  binary in objdump, it becomes clear that this is the first challenge that uses more than one function, as all previous challenges were solvable by analysing <strong><code>main()</code></strong>.</p>

<p>There are 3 non-library functions in this binary: <strong><code>main()</code></strong>, <strong><code>test()</code></strong> and <strong><code>shift()</code></strong>. Let&rsquo;s start by analysing <strong><code>main()</code></strong>.</p>

<h4 id="analysing-main">Analysing main</h4>

<p><img src="../../img/main annotated.jpg" alt="Main disassembly" title="Main disassembly" /></p>

<p>All instructions in the red box marked 1 are part of the function prologue, these allocate space for the stack-frame and aren&rsquo;t of too much interest to us.</p>

<p>As for the Instructions in the green box marked 2, we can ignore the first 2 calls to <strong><code>printf()</code></strong> as we know they represent the introduction and password prompt messages.</p>

<p>At instruction <strong><code>0x80484cc</code></strong> a local variable at address <strong><code>ebp-0x4</code></strong> is loaded into eax and then placed on the stack as a second argument to a <strong><code>scanf()</code></strong> call in the binary, from this we can infer that our input to the program will be stored at <strong><code>ebp-0x4</code></strong> and should watch for this address being used elsewhere in the function.</p>

<p><img src="../../img/ioli-level3-format-string-annotated.jpg" alt=".rodata strings" title=".rodata strings" /><br />
An address is then placed at the top of the stack as the first argument to <strong><code>scanf()</code></strong>, this is the format string that controls the way data is scanned and stored from <strong><code>scanf()</code></strong>&rsquo;s input. As annotated in the image above, the format string address points to a string containing a single format-specifier: <strong><code>%d</code></strong></p>

<p>This specifier denotes a signed-integer, so we now know the correct password for this binary will be numerical as it is scanned in as an integer value.</p>

<p><img src="../../img/ioli-level3-main-annotated-2.png" alt="Main disassembly" title="Main disassembly" /></p>

<p>From address <strong><code>0x80484df</code></strong> to <strong><code>0x8048e6</code></strong> the integers 90 and 492 are written to addresses <strong><code>ebp-0x8</code></strong> and <strong><code>ebp-0xc</code></strong> respectively. Then, the value at <strong><code>ebp-0x8</code></strong> (90) is incremented by the value of <strong><code>ebp-0xc</code></strong> (492), meaning the value at <strong><code>ebp-0x8</code></strong> is now 582 (492 + 90). The value at <strong><code>ebp-0x8</code></strong> is then squared and written to <strong><code>ebp-0xc</code></strong>, <strong><code>ebp-0xc</code></strong> now contains the value 338724 (582 ^ 2).</p>

<p>Once the above is complete, the program takes the value 338724 from <strong><code>ebp-0xc</code></strong>, and writes it to <strong><code>esp+0x4</code></strong> (1 DWORD away from the top of the stack), the instruction that follows writes the value located at <strong><code>ebp-0x4</code></strong> to the top of the stack, the function <strong><code>test()</code></strong> is then invoked.</p>

<p>If you remember from above, the value in <strong><code>ebp-0x4</code></strong> is significant, as it is the integer stored from the call to <strong><code>scanf()</code></strong>, this is the number we input as our password. It&rsquo;s apparent that the compiler used to compile these challenge binaries is implementing the <strong>cdecl</strong> calling convention, whereby arguments for functions are passed on the stack in reverse order. Considering this, we can infer that test&rsquo;s function signature is as follows:</p>

<pre><code>void test(int user_input, int num)
</code></pre>

<p>We also know from following the arithmetic operations that the argument &lsquo;num&rsquo; will always be the value 338724, therefore, the main function can be decompiled by hand as follows:</p>

<pre><code>int main() 
{
    int input;
    scanf(&quot;%d&quot;, input);
    test(input, 338724);
}
</code></pre>

<h4 id="analysing-test">Analysing test</h4>

<p>As we have a good understanding of main, and know the arguments it passes to the test function, we can now analyse test to see what it does with this data and how it makes decisions. Here is the disassembly of the test function:</p>

<p><img src="../../img/ioli-level3-test.png" alt="Test disassembly" title="Test disassembly" /></p>

<p>This function compares its two integer arguments, if the arguments are equal it calls shift with a string as its argument, if not, it calls shift with a different string as its argument. These are likely to be the success and failure messages the program outputs.</p>

<p>When looking at what data lies at the above mentioned addresses, we can see they look unintelligible, but they they look like they resemble English from eye-level frequency analysis. Let&rsquo;s verify this hypothesis&hellip;</p>

<h4 id="analysing-shift">Analysing shift</h4>

<p>As we inferred from the test function, the shift function takes an argument of a string, now we need to analyse the assembly to understand how the function uses the string.</p>

<p><img src="../../img/ioli-level3-shift-annotated.png" alt="Shift disassembly" title="Shift disassembly" /></p>

<p>In the red section marked 1, the function initializes a stack variable <strong><code>ebp-0x7c</code></strong> with the value 0, this variable stores the shift routine&rsquo;s iteration count. Next, it retrieves the length of the string argument, and compares it to the iteration count to determine whether the final character has been operated on or not.</p>

<p>If the final character has been operated on, then the routine is complete and the function jumps to the orange section marked 3, where it places a null-byte at the end of the shifted string and prints the string.</p>

<p>If the final character has not been operated on, the function continues into the green section marked 2. edx and eax are set to destination and source buffers respectively, and both are offset by the iteration count. The current byte in the source buffer is then decremented by 3 and written to the current byte in the destination buffer. The iteration count is then incremented.</p>

<p>The function then jumps to re-perform the check on whether the number of iterations is equal to the length of the string. This is what iteration looks like in assembly language.</p>

<p>This routine could be decompiled as follows:</p>

<pre><code>void shift(char* encrypted_str)
{
    char[124] cleartext_str;
    int i;
    for(i = 0; i &lt; strlen(encrypted_str); i++)
    {
        cleartext_str[i] = encrypted_str[i] - 3;
    }

    cleartext_str[i] = '\0';
    printf(cleartext_str);
}
</code></pre>

<p>So, now we understand the implementation of <strong><code>shift()</code></strong>, we can apply the algorithm used to decrypt the strings to find out what the strings signify about each path in <strong><code>test()</code></strong></p>

<p><img src="../../img/ioli-level3-decrypt-python.jpg" alt="Python decryption code" title="Python decryption code" /><br />
As you can see in the above image, I shifted each character in the string 3 bytes lower using python, the result shows that the second string located at <strong>0x80485fc</strong> decodes to &lsquo;Password OK!!! :)&lsquo;.</p>

<p>Looking back at the test function, we know which path is the one taken given a correct password, shift is called with the password ok string as its argument only when the user inputted the number 338724 as their password. Therefore, 338724 is the correct password to solve this challenge.</p>

<p><img src="../../img/ioli-level3-password-success.png" alt="Success message" title="Success message" /></p>

  </div>
  

<div class="navigation navigation-single">
    
    <a href="../../blog/owasp-bristol-ctf/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">Competing in OWASP Bristol’s CTF Tournament</span>
    </a>
    
    
</div>


  

  
    


</article>


        </div>
        
    
<script defer src="https://use.fontawesome.com/releases/v5.2.0/js/all.js"
  integrity="sha384-4oV5EgaV02iISL2ban6c/RmotsABqE4yZxZLcYMAdG7FAPsyHYAPpywE9PJo+Khy"
  crossorigin="anonymous">
</script>





    



    </body>
</html>
